# WEEB社交系统ER图 - Mermaid流程图代码

## 完整ER图
```mermaid
erDiagram
    %% 用户相关表
    USER {
        bigint id PK
        varchar username UK
        varchar password
        varchar sex
        varchar phone_number UK
        varchar user_email UK
        varchar unique_article_link
        varchar unique_video_link
        datetime registration_date
        varchar ip_ownership
        int type
        varchar avatar
        varchar nickname
        varchar badge
        datetime login_time
        text bio
        int online_status
        int status
        datetime created_at
        datetime updated_at
    }

    USER_STATS {
        bigint user_id PK,FK
        int fans_count
        bigint total_likes
        bigint total_favorites
        bigint total_sponsorship
        bigint total_article_exposure
        int website_coins
        datetime created_at
        datetime updated_at
    }

    USER_FOLLOW {
        bigint id PK
        bigint follower_id FK
        bigint followed_id FK
        datetime created_at
    }

    USER_LEVEL_HISTORY {
        bigint id PK
        bigint user_id FK
        int old_level
        int new_level
        varchar reason
        datetime created_at
    }

    %% 内容相关表
    ARTICLE_CATEGORY {
        int id PK
        varchar category_name UK
        text description
        int sort_order
        int status
        datetime created_at
        datetime updated_at
    }

    ARTICLE_TAG {
        int id PK
        varchar tag_name UK
        text description
        varchar color
        int usage_count
        datetime created_at
        datetime updated_at
    }

    ARTICLES {
        bigint article_id PK
        bigint user_id FK
        int category_id FK
        varchar article_title
        longtext article_content
        varchar article_link
        int status
        int likes_count
        int favorites_count
        int sponsors_count
        bigint exposure_count
        datetime created_at
        datetime updated_at
    }

    ARTICLE_TAG_RELATION {
        bigint id PK
        bigint article_id FK
        int tag_id FK
        datetime created_at
    }

    ARTICLE_COMMENT {
        bigint id PK
        bigint article_id FK
        bigint user_id FK
        bigint parent_comment_id FK
        text content
        int status
        datetime created_at
        datetime updated_at
    }

    ARTICLE_LIKE {
        bigint id PK
        bigint article_id FK
        bigint user_id FK
        datetime created_at
    }

    ARTICLE_FAVORITE {
        bigint id PK
        bigint article_id FK
        bigint user_id FK
        datetime created_at
    }

    ARTICLE_VERSION {
        bigint id PK
        bigint article_id FK
        int version_number
        longtext content
        varchar change_summary
        datetime created_at
    }

    ARTICLE_MODERATION_HISTORY {
        bigint id PK
        bigint article_id FK
        bigint moderator_id FK
        int old_status
        int new_status
        text reason
        datetime created_at
    }

    %% 通讯相关表
    CHAT_LIST {
        bigint id PK
        bigint user_id FK
        bigint target_id FK
        varchar chat_type
        varchar last_message
        datetime last_message_time
        int unread_count
        datetime created_at
        datetime updated_at
    }

    SHARED_CHAT {
        bigint id PK
        bigint creator_id FK
        varchar chat_name
        text description
        varchar chat_key UK
        int status
        datetime created_at
        datetime updated_at
    }

    CHAT_UNREAD_COUNT {
        bigint id PK
        bigint user_id FK
        bigint chat_id FK
        int unread_count
        datetime last_read_time
        datetime updated_at
    }

    MESSAGE {
        bigint id PK
        varchar client_message_id UK
        bigint sender_id FK
        bigint chat_id FK
        json content
        varchar message_type
        int read_status
        int is_recalled
        varchar user_ip
        varchar source
        bigint reply_to_message_id FK
        bigint thread_id FK
        int is_show_time
        datetime created_at
        datetime updated_at
    }

    MESSAGE_REACTION {
        bigint id PK
        bigint message_id FK
        bigint user_id FK
        varchar reaction_type
        datetime created_at
    }

    MESSAGE_RETRY {
        bigint id PK
        bigint message_id FK
        int retry_count
        varchar error_message
        datetime next_retry_time
        datetime created_at
    }

    %% 群组相关表
    GROUP_TABLE {
        bigint id PK
        bigint owner_id FK
        varchar group_name
        text group_description
        varchar group_avatar_url
        int group_type
        int status
        int is_public
        int max_members
        int member_count
        datetime create_time
        datetime last_transfer_at
        int transfer_count
        datetime created_at
        datetime updated_at
    }

    GROUP_MEMBER {
        bigint id PK
        bigint group_id FK
        bigint user_id FK
        int role
        datetime join_time
        datetime created_at
        datetime updated_at
    }

    GROUP_TRANSFER_HISTORY {
        bigint id PK
        bigint group_id FK
        bigint from_owner_id FK
        bigint to_owner_id FK
        text reason
        datetime transfer_time
        datetime created_at
    }

    GROUP_APPLICATION {
        bigint id PK
        bigint group_id FK
        bigint user_id FK
        int status
        text reason
        datetime created_at
        datetime updated_at
    }

    %% 系统功能表
    CONTACT {
        bigint id PK
        bigint user_id FK
        bigint friend_id FK
        int status
        text remarks
        datetime expire_at
        datetime create_time
        datetime update_time
        datetime created_at
        datetime updated_at
    }

    CONTACT_GROUP {
        bigint id PK
        bigint user_id FK
        varchar group_name
        text description
        int sort_order
        datetime created_at
        datetime updated_at
    }

    NOTIFICATION {
        bigint id PK
        bigint user_id FK
        varchar notification_type
        varchar title
        text content
        bigint related_id
        int status
        datetime created_at
        datetime updated_at
    }

    SYSTEM_LOG {
        bigint id PK
        bigint user_id FK
        varchar operation_type
        varchar module
        text description
        varchar ip_address
        varchar user_agent
        datetime created_at
    }

    CONTENT_REPORT {
        bigint id PK
        bigint reporter_id FK
        bigint content_type
        bigint content_id
        int reason_type
        text description
        int status
        datetime created_at
        datetime updated_at
    }

    %% 关系定义
    USER ||--o{ USER_STATS : "has"
    USER ||--o{ USER_FOLLOW : "follows"
    USER ||--o{ USER_LEVEL_HISTORY : "has"
    USER ||--o{ ARTICLES : "publishes"
    USER ||--o{ ARTICLE_COMMENT : "comments"
    USER ||--o{ ARTICLE_LIKE : "likes"
    USER ||--o{ ARTICLE_FAVORITE : "favorites"
    USER ||--o{ MESSAGE : "sends"
    USER ||--o{ CHAT_LIST : "has"
    USER ||--o{ CHAT_UNREAD_COUNT : "has"
    USER ||--o{ GROUP_MEMBER : "joins"
    USER ||--o{ GROUP_TABLE : "owns"
    USER ||--o{ CONTACT : "has"
    USER ||--o{ CONTACT_GROUP : "creates"
    USER ||--o{ NOTIFICATION : "receives"
    USER ||--o{ SYSTEM_LOG : "generates"
    USER ||--o{ CONTENT_REPORT : "reports"
    USER ||--o{ MESSAGE_REACTION : "reacts"

    ARTICLE_CATEGORY ||--o{ ARTICLES : "categorizes"
    ARTICLE_TAG ||--o{ ARTICLE_TAG_RELATION : "tags"
    ARTICLES ||--o{ ARTICLE_TAG_RELATION : "has"
    ARTICLES ||--o{ ARTICLE_COMMENT : "receives"
    ARTICLES ||--o{ ARTICLE_LIKE : "receives"
    ARTICLES ||--o{ ARTICLE_FAVORITE : "receives"
    ARTICLES ||--o{ ARTICLE_VERSION : "versions"
    ARTICLES ||--o{ ARTICLE_MODERATION_HISTORY : "moderates"

    MESSAGE ||--o{ MESSAGE_REACTION : "receives"
    MESSAGE ||--o{ MESSAGE_RETRY : "retries"
    MESSAGE ||--o{ ARTICLE_COMMENT : "replies"

    GROUP_TABLE ||--o{ GROUP_MEMBER : "contains"
    GROUP_TABLE ||--o{ GROUP_TRANSFER_HISTORY : "transfers"
    GROUP_TABLE ||--o{ GROUP_APPLICATION : "receives"

    %% 超类-子类关系标注
    note right of USER : "超类：用户基本信息"
    note right of USER_STATS : "子类：用户扩展统计"

    note right of ARTICLES : "超类：文章主体"
    note right of ARTICLE_COMMENT : "子类：评论"
    note right of ARTICLE_LIKE : "子类：点赞"
    note right of ARTICLE_FAVORITE : "子类：收藏"

    note right of MESSAGE : "超类：消息主体"
    note right of MESSAGE_REACTION : "子类：消息反应"
    note right of MESSAGE_RETRY : "子类：重试记录"

    note right of GROUP_TABLE : "超类：群组信息"
    note right of GROUP_MEMBER : "子类：成员关系"
    note right of GROUP_TRANSFER_HISTORY : "子类：转让历史"
```

## 简化S-C模式ER图（主要展示超类-子类关系）

```mermaid
erDiagram
    %% 用户S-C模式
    USER {
        bigint id PK
        varchar username
        varchar email
        int type
        int status
    }

    USER_STATS {
        bigint user_id PK,FK
        int fans_count
        bigint total_likes
        int website_coins
    }

    %% 内容S-C模式
    ARTICLES {
        bigint article_id PK
        bigint user_id FK
        varchar article_title
        int status
        int likes_count
    }

    ARTICLE_INTERACTION {
        bigint id PK
        bigint article_id FK
        bigint user_id FK
        varchar interaction_type
        datetime created_at
    }

    %% 消息S-C模式
    MESSAGE {
        bigint id PK
        bigint sender_id FK
        bigint chat_id FK
        text content
        int status
    }

    MESSAGE_META {
        bigint id PK
        bigint message_id FK
        varchar meta_type
        json meta_data
        datetime created_at
    }

    %% 群组S-C模式
    GROUP_TABLE {
        bigint id PK
        bigint owner_id FK
        varchar group_name
        int member_count
    }

    GROUP_RELATION {
        bigint id PK
        bigint group_id FK
        bigint user_id FK
        varchar relation_type
        datetime created_at
    }

    %% 关系定义
    USER ||--o{ USER_STATS : "扩展统计"
    USER ||--o{ ARTICLES : "发布"
    USER ||--o{ MESSAGE : "发送"
    USER ||--o{ GROUP_TABLE : "拥有"
    USER ||--o{ GROUP_RELATION : "参与"

    ARTICLES ||--o{ ARTICLE_INTERACTION : "互动"
    MESSAGE ||--o{ MESSAGE_META : "元数据"
    GROUP_TABLE ||--o{ GROUP_RELATION : "成员"

    %% S-C模式标注
    note over USER, USER_STATS : "用户-统计 S-C模式"
    note over ARTICLES, ARTICLE_INTERACTION : "文章-互动 S-C模式"
    note over MESSAGE, MESSAGE_META : "消息-元数据 S-C模式"
    note over GROUP_TABLE, GROUP_RELATION : "群组-关系 S-C模式"
```

## 数据表统计信息

```mermaid
pie title 数据表分类统计
    "用户相关表" : 4
    "内容相关表" : 11
    "通讯相关表" : 6
    "群组相关表" : 4
    "系统功能表" : 2
```

## S-C模式分类

```mermaid
graph TD
    A[WEEB系统S-C模式] --> B[用户-统计模式]
    A --> C[内容-互动模式]
    A --> D[消息-元数据模式]
    A --> E[群组-关系模式]

    B --> B1[user 超类]
    B --> B2[user_stats 子类]
    B --> B3[user_follow 子类]
    B --> B4[user_level_history 子类]

    C --> C1[articles 超类]
    C --> C2[article_comment 子类]
    C --> C3[article_like 子类]
    C --> C4[article_favorite 子类]
    C --> C5[article_version 子类]

    D --> D1[message 超类]
    D --> D2[message_reaction 子类]
    D --> D3[message_retry 子类]

    E --> E1[group 超类]
    E --> E2[group_member 子类]
    E --> E3[group_transfer_history 子类]
    E --> E4[group_application 子类]
```